<%- include('../partials/header') %>
<%- include('../partials/navbar') %>

<div class="container">
  <h1>๐ Bรกo Cรกo Thแปng Kรช Bรกn Vรฉ</h1>

  <!-- Redesigned report filter form -->
  <div class="form-box">
    <h2>๐ Chแปn Thรกng Vร Rแบกp ฤแป Xem Bรกo Cรกo</h2>
    <form method="POST" action="/management/reports/generate">
    <div class="form-row" style="align-items: flex-end; gap: 15px;">

      <!-- Month input -->
      <div class="form-group" style="flex: 1; display: flex; flex-direction: column;">
        <label for="month" style="">Chแปn thรกng</label>
        <input type="month" id="month" name="month" required style="height: 46px; padding: 6px;">
      </div>

      <!-- Theater multi-select -->
      <div class="form-group">
        <label for="theaterIds">๐ข Rแบกp chiแบฟu</label>
        <select id="theaterIds" name="theaterIds" multiple size="1" style="height: 46px; padding: 6px;">
          <% theaters.forEach(theater => { %>
            <option value="<%= theater.id %>"><%= theater.name %></option>
          <% }) %>
        </select>
      </div>

      <!-- Submit button -->
      <div class="form-group" style="flex: 0 0 auto; display: flex; flex-direction: column; justify-content: flex-end;">
        <button type="submit" class="btn btn-primary btn-block" style="height: 46px;">๐ Xem bรกo cรกo</button>
      </div>
    </div>

    </form>
  </div>

  <% if (report) { %>
  <!-- Enhanced report display with better styling -->
  <div class="report-box">
    <h2>๐ Bรกo Cรกo Thแปng Kรช Vรฉ Bรกn</h2>
    <div class="report-header">
      <p><strong>๐ Thรกng:</strong> <%= report.month %></p>
      <p><strong>๐ข Rแบกp ฤฦฐแปฃc chแปn:</strong> <%= report.selectedTheaters.map(t => t.name).join(', ') %></p>
      <p style="margin-top: 12px; padding-top: 12px; border-top: 1px solid #e8e8eb; font-size: 16px;">
        <strong>๐ซ Tแปng sแป vรฉ:</strong> <span style="color: #0071e3; font-weight: 700;"><%= report.totalTickets %></span>
        &nbsp;&nbsp;|&nbsp;&nbsp;
        <strong>๐ฐ Tแปng doanh thu:</strong> <span style="color: #34c759; font-weight: 700;"><%= report.totalRevenue.toLocaleString('vi-VN') %> ฤ</span>
      </p>
    </div>

    <% if (report.shifts.length > 0) { %>
    <div style="overflow-x: auto;">
      <table class="table report-table">
        <thead>
          <tr>
            <th>โฐ Ca chiแบฟu</th>
            <th>๐ซ Sแป vรฉ bรกn</th>
            <th>๐ฐ Doanh thu</th>
            <th>๐ Tแปท lแป (%)</th>
          </tr>
        </thead>
        <tbody>
          <% report.shifts.forEach(shift => { %>
          <tr>
            <td><strong><%= shift.shiftName %></strong></td>
            <td style="text-align: center;"><span style="background: #f5f5f7; padding: 6px 12px; border-radius: 4px; display: inline-block;"><%= shift.count %></span></td>
            <td><strong style="color: #34c759;"><%= shift.revenue.toLocaleString('vi-VN') %> ฤ</strong></td>
            <td>
              <div style="background: #f5f5f7; border-radius: 4px; padding: 4px 8px; text-align: center;">
                <span style="color: #0071e3; font-weight: 600;"><%= shift.percentage %>%</span>
              </div>
            </td>
          </tr>
          <% }) %>
        </tbody>
      </table>
    </div>
    <% } else { %>
      <p class="no-data">Khรดng cรณ dแปฏ liแปu vรฉ bรกn trong thรกng nรy.</p>
    <% } %>
  </div>
  <% } %>
</div>

<%- include('../partials/footer') %>
